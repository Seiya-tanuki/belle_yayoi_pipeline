# Script Properties Audit (Temporary)
Legacy/Outdated: see docs/CONFIG.md and docs/09_Dashboard_WebApp.md for current behavior.
## 1. Executive summary
- Recommended MUST_BLOCK_UI keys (core pipeline cannot run without these): `BELLE_SHEET_ID`, `BELLE_DRIVE_FOLDER_ID`, `BELLE_GEMINI_API_KEY`, `BELLE_GEMINI_MODEL`.
- Recommended WARN_ONLY keys (core still runs, but major feature impact): `BELLE_FISCAL_START_DATE`, `BELLE_FISCAL_END_DATE`, `BELLE_LOG_ARCHIVE_FOLDER_ID`, `BELLE_IMAGES_ARCHIVE_FOLDER_ID`, `BELLE_INTEGRATIONS_SHEET_ID`, `BELLE_OCR_MAX_ATTEMPTS`, `BELLE_OCR_RETRY_BACKOFF_SECONDS`, `BELLE_OCR_PARALLEL_ENABLED`, `BELLE_OCR_PARALLEL_WORKERS`.
- Minimal required property set for operational state (queue + OCR + export): `BELLE_SHEET_ID`, `BELLE_DRIVE_FOLDER_ID`, `BELLE_GEMINI_API_KEY`, `BELLE_GEMINI_MODEL`, `BELLE_FISCAL_START_DATE`, `BELLE_FISCAL_END_DATE`.
- Properties safe to omit (defaults or internal): `BELLE_ACTIVE_DOC_TYPES`, `BELLE_QUEUE_SHEET_NAME`, `BELLE_SKIP_LOG_SHEET_NAME`, `BELLE_QUEUE_SKIP_LOG_SHEET_NAME`, `BELLE_EXPORT_GUARD_LOG_SHEET_NAME`, `BELLE_CSV_ENCODING`, `BELLE_CSV_EOL`, `BELLE_EXPORT_BATCH_MAX_ROWS`, `BELLE_FALLBACK_APPEND_INVOICE_SUFFIX`, `BELLE_FALLBACK_DEBIT_TAX_KUBUN_DEFAULT`, `BELLE_ERROR_FINAL_TEKIYO_LABEL`, `BELLE_GEMINI_SLEEP_MS`, `BELLE_MAX_ITEMS_PER_RUN`, `BELLE_OCR_LOCK_TTL_SECONDS`, `BELLE_OCR_WORKER_MAX_ITEMS`, `BELLE_OCR_CLAIM_SCAN_MAX_ROWS`, `BELLE_OCR_CLAIM_CURSOR__*`, `BELLE_OCR_PARALLEL_TRIGGER_*`, `BELLE_OCR_GENCFG_JSON__*`, `BELLE_DASHBOARD_MODE`, `BELLE_DASHBOARD_MAINT_UNTIL_ISO`, `BELLE_MAINTENANCE_TTL_MINUTES`, `BELLE_RESET_TOKEN`, `BELLE_CHATWORK_WEBHOOK_*`.
- IDs that should be checked with openById/getFolderById (not just non-empty): `BELLE_SHEET_ID`, `BELLE_DRIVE_FOLDER_ID`, `BELLE_OUTPUT_FOLDER_ID`, `BELLE_INTEGRATIONS_SHEET_ID`, `BELLE_LOG_ARCHIVE_FOLDER_ID`, `BELLE_IMAGES_ARCHIVE_FOLDER_ID`.
- Notes on ambiguous keys needing clarification: legacy migration keys still exist (`BELLE_SHEET_NAME`, `BELLE_OCR_CLAIM_CURSOR`, `BELLE_CC_STAGE1_GENCFG_JSON`, `BELLE_CC_STAGE2_GENCFG_JSON`, `BELLE_BANK_STAGE2_GENCFG_JSON`); the legacy bank key maps to `BELLE_OCR_GENCFG_JSON__bank_statement__stage1`. Docs also list Chatwork notify keys that are not referenced in current gas code.

## 2. Property inventory (table)
| Key | Used in (file/function) | Default / Required | Validation rule (proposed) | Missing/Invalid behavior | Severity | Health-check action |
| --- | --- | --- | --- | --- | --- | --- |
| BELLE_SHEET_ID | gas/Config.js:belle_cfg_getSheetIdOrThrow_ (L83); belle_cfg_getSheetIdOrEmpty_ (L87). Docs: docs/CONFIG.md | Required | Non-empty spreadsheet ID; SpreadsheetApp.openById succeeds | Throws in core paths or returns MISSING_SHEET_ID guards; queue/OCR/export/maintenance blocked | CRITICAL | MUST_BLOCK_UI |
| BELLE_DRIVE_FOLDER_ID | gas/Config.js:belle_cfg_getDriveFolderIdOrThrow_ (L91); gas/Drive.js:belle_listFilesInFolder. Docs: docs/CONFIG.md | Required | Non-empty folder ID; DriveApp.getFolderById succeeds | Queue file listing fails; output fallback may also fail | CRITICAL | MUST_BLOCK_UI |
| BELLE_OUTPUT_FOLDER_ID | gas/Config.js:belle_cfg_getOutputFolderIdOrDriveFolderId_ (L98); belle_getOutputFolderId (L205). Docs: docs/CONFIG.md | Optional (fallback to BELLE_DRIVE_FOLDER_ID) | Empty or valid folder ID; if set, DriveApp.getFolderById succeeds | If set invalid: export fails when resolving output; if missing and drive missing, export throws | MEDIUM | WARN_ONLY |
| BELLE_QUEUE_SHEET_NAME | gas/Config.js:belle_cfg_getQueueSheetNameOverride_ (L108). Docs: docs/CONFIG.md | Optional (default empty -> OCR_RECEIPT) | Valid sheet name string | Missing uses default; if invalid name, new sheet may be created | LOW | NOT_CHECKED |
| BELLE_ACTIVE_DOC_TYPES | gas/DocTypeRegistry.js:belle_ocr_getActiveDocTypes_ (L155). Docs: docs/CONFIG.md | Optional (default receipt) | Comma-separated list of receipt, cc_statement, bank_statement | Unknown values ignored; if none valid, falls back to receipt | MEDIUM | WARN_ONLY |
| BELLE_OCR_GENCFG_JSON__receipt__stage1 | gas/Config.js:belle_cfg_getOcrGenCfgOverride_ (L127); gas/OcrReceiptPipeline.js. Docs: docs/CONFIG.md | Optional | JSON object string | Invalid JSON ignored with config warn; no override applied | LOW | NOT_CHECKED |
| BELLE_OCR_GENCFG_JSON__cc_statement__stage1 | gas/Config.js:belle_cfg_getOcrGenCfgOverride_ (L127); gas/Gemini.js. Docs: docs/CONFIG.md | Optional | JSON object string | Invalid JSON ignored with config warn; no override applied | LOW | NOT_CHECKED |
| BELLE_OCR_GENCFG_JSON__cc_statement__stage2 | gas/Config.js:belle_cfg_getOcrGenCfgOverride_ (L127); gas/Gemini.js. Docs: docs/CONFIG.md | Optional | JSON object string | Invalid JSON ignored with config warn; no override applied | LOW | NOT_CHECKED |
| BELLE_OCR_GENCFG_JSON__bank_statement__stage1 | gas/Config.js:belle_cfg_getOcrGenCfgOverride_ (L127); gas/Gemini.js. Docs: docs/CONFIG.md | Optional | JSON object string | Invalid JSON ignored with config warn; no override applied | LOW | NOT_CHECKED |
| BELLE_CC_ENABLE_RESPONSE_JSON_SCHEMA | gas/Gemini.js:belle_ocr_cc_enableResponseJsonSchema_ (L259). Docs: docs/CONFIG.md | Optional (default false) | Boolean string (true/false/1/0/yes/no) | Missing/invalid -> false | LOW | NOT_CHECKED |
| BELLE_CC_ENABLE_RESPONSE_MIME_TYPE | gas/Gemini.js:belle_ocr_cc_enableResponseMimeType_ (L264). Docs: docs/CONFIG.md | Optional (default false) | Boolean string (true/false/1/0/yes/no) | Missing/invalid -> false | LOW | NOT_CHECKED |
| BELLE_GEMINI_API_KEY | gas/Gemini.js:belle_getGeminiConfig (L14). Docs: docs/CONFIG.md | Required | Non-empty API key string | belle_getGeminiConfig throws; all OCR calls fail | CRITICAL | MUST_BLOCK_UI |
| BELLE_GEMINI_MODEL | gas/Gemini.js:belle_getGeminiConfig (L15). Docs: docs/CONFIG.md | Required | Non-empty model name string | belle_getGeminiConfig throws; all OCR calls fail | CRITICAL | MUST_BLOCK_UI |
| BELLE_GEMINI_SLEEP_MS | gas/Gemini.js:belle_getGeminiConfig (L16). Docs: docs/CONFIG.md | Optional (default 500) | Number >= 0 | Missing -> 500; invalid -> NaN (sleep skipped) | LOW | NOT_CHECKED |
| BELLE_MAX_ITEMS_PER_RUN | gas/Gemini.js:belle_getGeminiConfig (L17). Docs: docs/CONFIG.md | Optional (default 1) | Number >= 1 | Missing -> 1; invalid -> NaN (loop limits may be bypassed) | LOW | NOT_CHECKED |
| BELLE_OCR_MAX_ATTEMPTS | gas/Queue.js:belle_processQueueOnceForDocType_ (L452); gas/OcrWorkerParallel.js (L100). Docs: docs/CONFIG.md | Optional (default 3) | Integer >= 1 | Missing -> 3; invalid -> NaN (max attempts check may never trigger) | MEDIUM | WARN_ONLY |
| BELLE_OCR_RETRY_BACKOFF_SECONDS | gas/Queue.js (L453); gas/OcrWorkerParallel.js (L101); gas/OcrReceiptPipeline.js (L19); gas/OcrBankStatementPipeline.js (L19). Docs: docs/CONFIG.md | Optional (default 300) | Number >= 1 | Missing -> 300; invalid -> NaN (next retry timestamp can be invalid) | MEDIUM | WARN_ONLY |
| BELLE_OCR_LOCK_TTL_SECONDS | gas/OcrWorkerParallel.js:belle_ocr_worker_resolveTtlSeconds_ (L69). Docs: docs/CONFIG.md | Optional (default 300) | Number >= 1 | Invalid -> default 300 | LOW | NOT_CHECKED |
| BELLE_OCR_WORKER_MAX_ITEMS | gas/OcrWorkerParallel.js:belle_ocr_workerLoop_ (L414). Docs: docs/CONFIG.md | Optional (default 1) | Number >= 1 | Invalid -> default 1 | LOW | NOT_CHECKED |
| BELLE_OCR_CLAIM_SCAN_MAX_ROWS | gas/Queue.js:belle_ocr_claimNextRow_ (L294). Docs: docs/CONFIG.md | Optional (unset -> scan all) | Number >= 1 | Invalid -> scan all rows | LOW | NOT_CHECKED |
| BELLE_OCR_CLAIM_CURSOR__receipt | gas/Queue.js:belle_ocr_buildClaimCursorKey_ (L205-206); gas/Config.js:belle_cfg_getOcrClaimCursorRaw_ (L133). Docs: docs/CONFIG.md | Internal (auto-managed) | Integer >= 0 | Missing -> starts at 0 | LOW | NOT_CHECKED |
| BELLE_OCR_CLAIM_CURSOR__cc_statement | gas/Queue.js:belle_ocr_buildClaimCursorKey_ (L205-206); gas/Config.js:belle_cfg_getOcrClaimCursorRaw_ (L133). Docs: docs/CONFIG.md | Internal (auto-managed) | Integer >= 0 | Missing -> starts at 0 | LOW | NOT_CHECKED |
| BELLE_OCR_CLAIM_CURSOR__bank_statement | gas/Queue.js:belle_ocr_buildClaimCursorKey_ (L205-206); gas/Config.js:belle_cfg_getOcrClaimCursorRaw_ (L133). Docs: docs/CONFIG.md | Internal (auto-managed) | Integer >= 0 | Missing -> starts at 0 | LOW | NOT_CHECKED |
| BELLE_OCR_PARALLEL_ENABLED | gas/OcrParallelTrigger.js:belle_ocr_workerTick (L157); belle_ocr_parallel_disable (L252). Docs: docs/CONFIG.md | Optional (default false) | Boolean string | Missing -> false; triggers still exist but tick exits early | MEDIUM | WARN_ONLY |
| BELLE_OCR_PARALLEL_WORKERS | gas/OcrParallelTrigger.js:belle_ocr_parallel_getWorkerCount_ (L65). Docs: docs/CONFIG.md | Optional (default 1) | Integer 1-20 | Invalid -> enable returns INVALID_WORKER_COUNT and does not create triggers | MEDIUM | WARN_ONLY |
| BELLE_OCR_PARALLEL_TRIGGER_TAG | gas/OcrParallelTrigger.js:belle_ocr_parallel_getTag_ (L61). Docs: docs/CONFIG.md | Optional (default BELLE_OCR_PARALLEL_V0) | String | Missing -> default tag | LOW | NOT_CHECKED |
| BELLE_OCR_PARALLEL_TRIGGER_IDS | gas/OcrParallelTrigger.js:belle_ocr_parallel_parseTriggerIds_ (L72). Docs: docs/CONFIG.md | Internal (auto-managed) | JSON array of trigger IDs | Invalid -> empty list (triggers recreated) | LOW | NOT_CHECKED |
| BELLE_OCR_PARALLEL_STAGGER_WINDOW_MS | gas/OcrParallelTrigger.js:belle_ocr_parallel_resolveStaggerWindowMs_ (L127). Docs: docs/CONFIG.md | Optional (default 50000) | Integer 0-59000 | Invalid -> 50000; clamped to range | LOW | NOT_CHECKED |
| BELLE_CSV_ENCODING | gas/Export.js:belle_exportYayoiCsv* (L155, L571, L935). Docs: docs/CONFIG.md | Optional (default SHIFT_JIS) | "SHIFT_JIS" or "UTF8" (case-insensitive) | Invalid -> treated as Shift_JIS | LOW | NOT_CHECKED |
| BELLE_CSV_EOL | gas/Export.js:belle_exportYayoiCsv* (L156, L572, L936). Docs: docs/CONFIG.md | Optional (default CRLF) | "CRLF" or "LF" (case-insensitive) | Invalid -> treated as CRLF | LOW | NOT_CHECKED |
| BELLE_EXPORT_BATCH_MAX_ROWS | gas/Export.js:belle_exportYayoiCsv* (L157, L573, L937). Docs: docs/CONFIG.md | Optional (default 5000) | Integer >= 1 | Invalid -> NaN (batch sizing may break) | MEDIUM | WARN_ONLY |
| BELLE_FALLBACK_APPEND_INVOICE_SUFFIX | gas/Export.js:belle_exportYayoiCsvReceiptInternal_ (L158). Docs: docs/CONFIG.md | Optional (default true) | Boolean string | Invalid -> default true | LOW | NOT_CHECKED |
| BELLE_FALLBACK_DEBIT_TAX_KUBUN_DEFAULT | gas/Export.js:belle_exportYayoiCsvReceiptInternal_ (L160). Docs: docs/CONFIG.md | Optional (default non-ASCII literal in code) | Non-empty string | Missing -> default literal; invalid -> used as-is | LOW | NOT_CHECKED |
| BELLE_ERROR_FINAL_TEKIYO_LABEL | gas/Export.js:belle_exportYayoiCsvReceiptInternal_ (L161). Docs: docs/CONFIG.md | Optional (default BELLE) | String | Missing -> default label | LOW | NOT_CHECKED |
| BELLE_FISCAL_START_DATE | gas/Export.js:belle_exportYayoiCsv* (L162, L574, L938); gas/YayoiExport.js:belle_yayoi_validateFiscalRange (L84). Docs: docs/CONFIG.md | Required for export | YYYY-MM-DD; start and end same year | Missing/invalid -> EXPORT_GUARD with FISCAL_RANGE_NOT_CONFIGURED | HIGH | WARN_ONLY |
| BELLE_FISCAL_END_DATE | gas/Export.js:belle_exportYayoiCsv* (L163, L575, L939); gas/YayoiExport.js:belle_yayoi_validateFiscalRange (L84). Docs: docs/CONFIG.md | Required for export | YYYY-MM-DD; end >= start | Missing/invalid -> EXPORT_GUARD with FISCAL_RANGE_NOT_CONFIGURED | HIGH | WARN_ONLY |
| BELLE_SKIP_LOG_SHEET_NAME | gas/Config.js:belle_cfg_getSkipLogSheetName_ (L112); gas/Log.js:belle_getSkipLogSheetName. Docs: docs/CONFIG.md | Optional (default EXPORT_SKIP_LOG) | Sheet name string | Missing -> default; invalid -> new sheet created | LOW | NOT_CHECKED |
| BELLE_QUEUE_SKIP_LOG_SHEET_NAME | gas/Config.js:belle_cfg_getQueueSkipLogSheetName_ (L116); gas/Log.js:belle_getQueueSkipLogSheetName. Docs: docs/CONFIG.md | Optional (default QUEUE_SKIP_LOG) | Sheet name string | Missing -> default; invalid -> new sheet created | LOW | NOT_CHECKED |
| BELLE_EXPORT_GUARD_LOG_SHEET_NAME | gas/Config.js:belle_cfg_getExportGuardLogSheetName_ (L120); gas/Log.js:belle_getExportGuardLogSheetName. Docs: docs/CONFIG.md | Optional (default EXPORT_GUARD_LOG) | Sheet name string | Missing -> default; invalid -> new sheet created | LOW | NOT_CHECKED |
| BELLE_INTEGRATIONS_SHEET_ID | gas/OcrWorkerParallel.js:belle_ocr_perf_appendFromSummary_ (L14); gas/ChatworkWebhook.js (L74); gas/DashboardAuditLog.js (L14); gas/LogArchiveService.js (L53). Docs: docs/CONFIG.md, docs/09_Dashboard_WebApp.md | Optional (required for integrations logs) | Non-empty spreadsheet ID; openById succeeds | Missing -> perf/audit/webhook logs skip; log archive fails | MEDIUM | WARN_ONLY |
| BELLE_LOG_ARCHIVE_FOLDER_ID | gas/LogArchiveService.js:belle_archive_getReportFolder_ (L13). Docs: docs/09_Dashboard_WebApp.md | Required for maintenance archive/report | Non-empty folder ID; DriveApp.getFolderById succeeds | Missing/invalid -> maintenance log archive and report copy fail | HIGH | WARN_ONLY |
| BELLE_IMAGES_ARCHIVE_FOLDER_ID | gas/ExportRunService.js (L214); gas/ImageArchiveService.js (L49). Docs: docs/09_Dashboard_WebApp.md | Required for maintenance image archive | Non-empty folder ID; DriveApp.getFolderById succeeds | Missing/invalid -> export-run maintenance fails after export | HIGH | WARN_ONLY |
| BELLE_MAINTENANCE_TTL_MINUTES | gas/MaintenanceMode.js:belle_maint_getTtlMinutes_ (L10). Docs: docs/09_Dashboard_WebApp.md | Optional (default 30) | Integer >= 1 | Missing/invalid -> 30 | LOW | NOT_CHECKED |
| BELLE_DASHBOARD_MODE | gas/MaintenanceMode.js:belle_maint_getState_ (L18). Docs: none (internal) | Internal (auto-managed) | "OCR" or "MAINTENANCE" | Missing -> defaults to OCR | LOW | NOT_CHECKED |
| BELLE_DASHBOARD_MAINT_UNTIL_ISO | gas/MaintenanceMode.js:belle_maint_getState_ (L20). Docs: none (internal) | Internal (auto-managed) | ISO8601 datetime | Missing/invalid -> maintenance expires to OCR | LOW | NOT_CHECKED |
| BELLE_CHATWORK_WEBHOOK_ENABLED | gas/ChatworkWebhook.js:belle_chatwork_webhook_handle_ (L127). Docs: docs/CONFIG.md | Optional (default false) | Boolean string | Missing/invalid -> false; webhook accepts but no action | LOW | NOT_CHECKED |
| BELLE_CHATWORK_WEBHOOK_ROUTE | gas/ChatworkWebhook.js:belle_chatwork_webhook_getExpectedRoute_ (L14). Docs: docs/CONFIG.md | Optional (default chatwork) | Route string | Missing -> default route | LOW | NOT_CHECKED |
| BELLE_CHATWORK_WEBHOOK_TOKEN | gas/ChatworkWebhook.js:belle_chatwork_webhook_handle_ (L177). Docs: docs/CONFIG.md | Required when webhook enabled | Non-empty shared secret | Missing/mismatch -> webhook guards and returns ok | MEDIUM | WARN_ONLY |
| BELLE_RESET_TOKEN | gas/Sheet.js:belle_resetSpreadsheetToInitialStateInternal_ (L130). Docs: docs/CONFIG.md | Optional (admin-only) | Exact match to expected token | Missing/mismatch -> reset guard, no destructive action | LOW | NOT_CHECKED |
| BELLE_CC_STAGE1_GENCFG_JSON (legacy) | gas/PropertiesMigration_v1.js:mappings (L7). Docs: legacy only | Legacy only | JSON string | Only used for migration to canonical key | LOW | NOT_CHECKED |
| BELLE_CC_STAGE2_GENCFG_JSON (legacy) | gas/PropertiesMigration_v1.js:mappings (L11). Docs: legacy only | Legacy only | JSON string | Only used for migration to canonical key | LOW | NOT_CHECKED |
| BELLE_BANK_STAGE2_GENCFG_JSON (legacy) | gas/PropertiesMigration_v1.js:mappings (L15). Docs: legacy only | Legacy only | JSON string | Only used for migration to canonical key | LOW | NOT_CHECKED |
| BELLE_SHEET_NAME (legacy) | gas/PropertiesMigration_v1.js:mappings (L19). Docs: legacy only | Legacy only | Sheet name string | Only used for migration to BELLE_QUEUE_SHEET_NAME | LOW | NOT_CHECKED |
| BELLE_OCR_CLAIM_CURSOR (legacy) | gas/PropertiesMigration_v1.js:mappings (L23). Docs: legacy only | Legacy only | Integer >= 0 | Only used for migration to BELLE_OCR_CLAIM_CURSOR__receipt | LOW | NOT_CHECKED |

## 3. Detailed notes (per key)
- BELLE_SHEET_ID: Required by queue, OCR, export, dashboard overview, and maintenance. When missing, many entrypoints throw or return MISSING_SHEET_ID guards, so no pipeline actions can complete.
- BELLE_DRIVE_FOLDER_ID: Required for queue ingestion and also used as the fallback output folder. Missing or invalid ID prevents file discovery and can block export output resolution.
- BELLE_GEMINI_API_KEY / BELLE_GEMINI_MODEL: belle_getGeminiConfig throws if either is missing, which stops all OCR processing (both single and parallel workers).
- BELLE_FISCAL_START_DATE / BELLE_FISCAL_END_DATE: Export uses belle_yayoi_validateFiscalRange; missing or invalid values cause EXPORT_GUARD and produce no CSV output.
- BELLE_LOG_ARCHIVE_FOLDER_ID: Required by belle_archive_getReportFolder_ for log archive and export-run report copy. If missing/invalid, maintenance archive workflows cannot proceed.
- BELLE_IMAGES_ARCHIVE_FOLDER_ID: Required by belle_image_archive_run_ and export-run maintenance. If missing/invalid, export-run maintenance fails after export and no clearing occurs.

## 4. Recommended health-check design (draft)
- Presence checks on page load: `BELLE_SHEET_ID`, `BELLE_DRIVE_FOLDER_ID`, `BELLE_GEMINI_API_KEY`, `BELLE_GEMINI_MODEL`.
- Access checks on page load (safe, fast): `SpreadsheetApp.openById(BELLE_SHEET_ID)`, `DriveApp.getFolderById(BELLE_DRIVE_FOLDER_ID)`.
- Conditional checks before export: validate `BELLE_FISCAL_START_DATE`/`BELLE_FISCAL_END_DATE` format and ordering; verify output folder (`BELLE_OUTPUT_FOLDER_ID` or fallback) is accessible.
- Conditional checks before maintenance actions: `BELLE_LOG_ARCHIVE_FOLDER_ID`, `BELLE_IMAGES_ARCHIVE_FOLDER_ID`, and `BELLE_INTEGRATIONS_SHEET_ID` should be present and accessible; fail fast if not.
- Validation checks (non-blocking warnings): numeric ranges for `BELLE_OCR_MAX_ATTEMPTS`, `BELLE_OCR_RETRY_BACKOFF_SECONDS`, `BELLE_EXPORT_BATCH_MAX_ROWS`, and trigger config; boolean parsing for `BELLE_OCR_PARALLEL_ENABLED` and Chatwork webhook flags.
- Optional checks (on demand only): JSON parsing for `BELLE_OCR_GENCFG_JSON__*` overrides; if invalid, warn and ignore.
